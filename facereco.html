<!DOCTYPE html SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
	<script type="text/javascript">Object.defineProperty(window.navigator, 'userAgent', { get: function(){ return 'Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25'; } });Object.defineProperty(window.navigator, 'vendor', { get: function(){ return 'Apple, Inc.'; }}); Object.defineProperty(window.navigator, 'platform', { get: function(){ return 'iPhone'; } });</script>
-->
	<title>Crédit Agricole d'Ile-de-France - Banque en ligne mobile</title>

	<meta name="viewport" content="width=320, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="description" content="Site mobile du Crédit Agricole: accédez à vos comptes bancaires, effectuez des virements, découvrez nos services.">
	<link rel="stylesheet" href="./home_files/bk.css">
	<link rel="stylesheet" href="./home_files/wope.css">
	<link href="./home_files/default.css" rel="stylesheet" type="text/css">

	<script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.0.0.js"></script>
<!--	
	<script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.4.js"></script>
	<style type="text/css"></style>
	<script type="text/javascript" src="./home_files/bk.js"></script>
	<script type="text/javascript" src="./home_files/virtualKeyboard_generic.js"></script>
	<script type="text/javascript" src="./home_files/geoloc.js"></script>
	<script type="text/javascript" src="./home_files/login_input.js"></script>
	<script type="text/javascript" src="./home_files/asideCover.js"></script>
	<script type="text/javascript" src="./home_files/accountSelection.js"></script>
	<script type="text/javascript" src="./home_files/accountSelectionSepa.js"></script>
	<script type="text/javascript" src="./home_files/equalizingHeight.js"></script>
	<script type="text/javascript" src="./home_files/eluminate.js"></script>
	<script type="text/javascript">
		var idBam="88200";var idClient="50580000"+"|"+idBam+"_CLI_2";var urlCormetrics="data.de.coremetrics.com";var domain="ca-paris.fr";if("Accueil"){var chapter="Accueil";var page="AccueilRegional";var idPartner="";var attributes=idPartner+"-_--_--_--_--_--_--_--_-"+idBam;var userLogged="false";var userAcceptCmCookies="true";var registartionId=idBam+"-"+idPartner;if(userAcceptCmCookies==="true"){cmSetClientID(idClient,true,urlCormetrics,domain);cmSetupOther({"cm_JSFCoreCookieExpireSeconds":"33696000"});cmCreatePageviewTag(page,chapter,"","",attributes);Bk.onePageLoaded(function(){if(userLogged==="true"){cmCreateRegistrationTag(registartionId,null,null,null,null,null,"-_--_--_--_--_--_--_--_-"+idBam);};});}}
	</script>
	<script src="./home_files/head.js"></script>
	<script language="javascript" type="text/javascript" src="./home_files/50580000.js"></script>
	<script language="javascript" type="text/javascript" src="./home_files/dispatcher-v3.js"></script>
	<script src="./home_files/yahoo-min.js" type="text/javascript"></script>
	<script src="./home_files/cp-v3.js" type="text/javascript"></script>
	<script src="./home_files/json-min.js" type="text/javascript"></script>
-->
	<script>

		// Put event listeners into place
		window.addEventListener("DOMContentLoaded", function() {
			// Grab elements, create settings, etc.
			var canvas = document.getElementById("canvas"),
				context = canvas.getContext("2d"),
				video = document.getElementById("video"),
				videoObj = { "video": true, "audio": false },
				errBack = function(error) {
					console.log("Video capture error: ", error.code); 
				};

			// Put video listeners into place
			if(navigator.getUserMedia) { // Standard
				navigator.getUserMedia(videoObj, function(stream) {
					video.src = stream;
					video.play();
				}, errBack);
			} else if(navigator.webkitGetUserMedia) { // WebKit-prefixed
				navigator.webkitGetUserMedia(videoObj, function(stream){
					video.src = window.webkitURL.createObjectURL(stream);
					video.play();
				}, errBack);
			} else if(navigator.mozGetUserMedia) { // WebKit-prefixed
				navigator.mozGetUserMedia(videoObj, function(stream){
					video.src = window.URL.createObjectURL(stream);
					video.play();
				}, errBack);
			}
		
			// Trigger photo take
			document.getElementById("snap").addEventListener("click", function() {
				context.drawImage(video, 0, 0, 400, 320);	
				pngHolder = document.getElementById("pngHolder")
				pngimage = document.getElementById("pngimage")				

//				var image = convertCanvasToImage(canvas);
//				pngHolder.replaceChild( image , pngimage );
				var binaryData = dataURItoBlob( canvas.toDataURL("image/png") );
				
				// Detect faces on the image calling the FACE API
				var faceID = detect(binaryData);
				console.log(faceID);
				var confidence = findsimilars(faceID);
				console.log(confidence);
				logintest(0.70,confidence);	// Seuil de confiance à 70% de match
				
			}, false);
			
			// Converts canvas to an image
			function convertCanvasToImage(canvas) {
				var image = new Image();
				image.src = canvas.toDataURL("image/png");
				image.id = "pngimage";
				return image;
			}

			function logintest(level,confidence) {
				if( confidence > level) {
			//		document.getElementById("confidence").innerHTML = ("Accès autorisé (confiance : " + (confidence * 100) + "%)");
					window.location.href = './acces_ok.html?confidence=' + confidence;
				} else {
			//		document.getElementById("confidence").innerHTML = ("Accès refusé (confiance : " + (confidence * 100) + "%)");
					window.location.href = './acces_ko.html?confidence=' + confidence;
				}
			}
			
			// Detect faces on the image calling the FACE API
			function detect(binaryData){
				var faceID = "error";
				$.ajax({		
					url: 'https://api.projectoxford.ai/face/v1.0/detect?returnFaceAttributes=age,gender',
					type: 'POST',
					dataType: 'JSON',
					headers: {
//						'Content-Type':'application/json',
						'Content-Type':'application/octet-stream',
						'Ocp-Apim-Subscription-Key':'ce2a8c99da534c629db74e0918bc2861'
					},			
//					data: JSON.stringify( { "url": "https://facerecognitionaleki.azurewebsites.net/faces/aleki1.png" } ),
					data: binaryData,
					processData: false,
					async: false,
					error: function( errorThrown ){
						console.log( errorThrown );
						return errorThrown;
					},
					success: function( data ){
						console.log( JSON.stringify( data ) );	
						data.forEach(function(face){
					//		console.log( face.faceAttributes.gender);
					//		console.log( face.faceAttributes.age);
					//		console.log( face.faceId);
							faceID = face.faceId;
						});
					}
				});
				return faceID;
			}

			// Find similarities to authorize access
			function findsimilars(faceID) {
				var confidence = 0;
				$.ajax({		
					url: 'https://api.projectoxford.ai/face/v1.0/findsimilars',
					type: 'POST',
					dataType: 'JSON',
					headers: {
						'Content-Type':'application/json',
						'Ocp-Apim-Subscription-Key':'ce2a8c99da534c629db74e0918bc2861'
					},			
					data: JSON.stringify( { 'faceId': faceID , 'faceListId':'authorized', 'maxNumOfCandidatesReturned':1 } ),
					processData: false,
					async: false,
					error: function( errorThrown ){
						console.log( errorThrown );
						return errorThrown;
					},
					success: function( data ){
						console.log( JSON.stringify( data ) );	
						data.forEach(function(face){
					//		console.log(face.confidence);
							confidence = face.confidence;
						});
					}
				});
				return confidence
			}	
				
			function dataURItoBlob(dataURI) {
			  // convert base64 to raw binary data held in a string
			  // doesn't handle URLEncoded DataURIs - see SO answer #6850276 for code that does this
			  var byteString = atob(dataURI.split(',')[1]);

			  // separate out the mime component
			  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]

			  // write the bytes of the string to an ArrayBuffer
			  var ab = new ArrayBuffer(byteString.length);
			  var ia = new Uint8Array(ab);
			  for (var i = 0; i < byteString.length; i++) {
				  ia[i] = byteString.charCodeAt(i);
			  }

			  // write the ArrayBuffer to a blob, and you're done
			  var blob = new Blob([ab], {type: mimeString});
			  return blob;
			}
			
		}, false);

	</script>
	   
	<script>                
		jQuery(function($){
			console.log("jQuery est prêt !");
		});
    </script>
	
</head>

<body>
<div id="bk-main-loader" style="display:none;"><div class="bk-loader"><img src="./home_files/bk-loader.gif" alt="Loading..." class="bk-loader"></div></div><div id="bk-body">
<h1 class="bk-hx header" style="background-color:#20787D;height: 50px;padding-top: 6px;padding-left: 5px; padding-right: 5px;"> <span class="header_title_wrapper aside_title_cover allwidth "> <span class="" id="aside_header_cover" style="-webkit-transform: translate3d(0,0,0);opacity:0;"></span> <a href="https://m.ca-paris.fr/information/sosNumbersList" data-bk-transition="fade" class="sos_header"><img alt="SOS" src="https://m.ca-paris.fr/bkimages/img/evol/ico_sos@2x.gif/627/480/GIF" width="24" class="bk"></a> <a href="https://m.ca-paris.fr/" class="logo"><img alt="Logo CA" src="https://m.ca-paris.fr/bkimages/img/evol/img_logo_ca@2x.gif/627/480/GIF" width="52" class="bk ca-logo"></a> <span class="header_title" style="color:#ffffff;"> <span class="name"> d'Ile-de-France </span> <br> <span class="slogan"> Banque et Assurances </span> </span> </span> </h1>
<div class="bk-dv " id="aside_content_cover" style="margin:0;padding:0;-webkit-transform: translate3d(0,0,0);opacity:0;"><div class="bk-clr"></div></div><div id="contentWithoutMenuAndFooter"><div id="defaultSection">
<h2 class="bk-hx sub_header padded bottom_shadow" style="background-color:#E2E9E9; color:#046366;"> ACCÈS COMPTE - RECONNAISSANCE FACIALE </h2>

<div class="Form" style=" background-color: #ffffff ; ">
	
		<style type="text/css">
		.my_content_container button {		align-items:flex-start;background-color:rgb(0,137,144);background-image:-webkit-linear-gradient(top,rgb(0,137,144)0px,rgb(63,149,152)1%,rgb(56,143,147)14%,rgb(34,124,128)44%,rgb(29,115,119)68%,rgb(29,107,111)99%,rgb(0,137,144)100%);border-bottom-color:rgb(255,255,255);border-bottom-left-radius:0px;border-bottom-right-radius:0px;border-bottom-style:none;border-bottom-width:0px;border-image-outset:0px;border-image-repeat:stretch;border-image-slice:100%;border-image-source:none;border-image-width:1;border-left-color:rgb(255,255,255);border-left-style:none;border-left-width:0px;border-right-color:rgb(255,255,255);border-right-style:none;border-right-width:0px;border-top-color:rgb(255,255,255);border-top-left-radius:0px;border-top-right-radius:0px;border-top-style:none;border-top-width:0px;box-sizing:border-box;color:rgb(255,255,255);cursor:default;display:inline-block;font-family:Arial;font-size:16px;font-stretch:normal;font-style:normal;font-variant:normal;font-weight:normal;height:38px;letter-spacing:normal;line-height:normal;margin-bottom:10px;margin-left:10px;margin-right:10px;margin-top:10px;outline-color:rgb(255,255,255);outline-style:none;outline-width:0px;padding-bottom:10px;padding-left:20px;padding-right:20px;padding-top:10px;text-align:center;text-indent:0px;text-rendering:auto;text-shadow:none;text-transform:none;white-space:pre;width:150px;word-spacing:0px;writing-mode:horizontal-tb;-webkit-appearance:none;-webkit-rtl-ordering:logical;-webkit-user-select:none;text-decoration: none;word-wrap:inherit;
		}
		</style>
		
		<video id="video" width="400" height="320" autoplay></video>
		<canvas id="canvas" width="400" height="320" style="display:none;"></canvas>
		
		<div class="fsbmit my_content_container">
			<button id="snap">Vérifier Identité</button>
		</div>
		<p id="confidence"></p>

</div>

<div class="tabSectionHome_hub down4" id="tabSectionOffPart1"><div class="bk-dv tabHome"> <a href="https://m.ca-paris.fr/information/mobileServices"><img alt="Services mobiles" src="https://m.ca-paris.fr/bkimages/img/evol/services_mobiles@2x.gif/627/480/GIF" width="89" class="bk tab"><img alt="Services mobiles" src="https://m.ca-paris.fr/bkimages/img/evol/services_mobiles_ico@2x.gif/627/480/GIF" width="31" class="bk tab bk-float-right"></a><a href="https://m.ca-paris.fr/branch/form"><img alt="Trouver une agence" src="https://m.ca-paris.fr/bkimages/img/evol/trouver_agence@2x.gif/627/480/GIF" width="89" class="bk tab"><img alt="Trouver une agence" src="https://m.ca-paris.fr/bkimages/img/evol/trouver_agence_ico@2x.gif/627/480/GIF" width="31" class="bk tab bk-float-left"></a> <div class="bk-clr"></div></div></div>

<div class="tabSectionHome_hub" id="tabSectionOffPart2_a_NotRegional"><div class="bk-dv tabHome"> <a href="https://m.ca-paris.fr/information/contact"><img alt="Contact" src="https://m.ca-paris.fr/bkimages/img/evol/contact@2x.gif/627/480/GIF" width="89" class="bk tab"><img alt="Contact" src="https://m.ca-paris.fr/bkimages/img/evol/contact_ico@2x.gif/627/480/GIF" width="31" class="bk tab bk-float-right"></a> <a href="https://m.ca-paris.fr/information/knowmore"><img alt="En savoir +" src="https://m.ca-paris.fr/bkimages/img/evol/know_more@2x.gif/627/480/GIF" width="89" class="bk tab"><img alt="En savoir +" src="https://m.ca-paris.fr/bkimages/img/evol/know_more_ico@2x.gif/627/480/GIF" width="31" class="bk tab bk-float-left"></a> <div class="bk-clr"></div></div></div>

<div id="regionalContactTransitionSection" style="display:none"><h2 class="bk-hx padded_left padded_top sub_header_with_subtitle bottom_shadow" style="background-color:#E2E9E9; color:#046366;"> <img alt="contact" src="https://m.ca-paris.fr/bkimages/img/evol/ico_contact_green.gif/752/600/GIF" width="23" class="bk"> <span>CONTACT</span> </h2><div id="regionalContactTransitionLoadingSection"></div></div>

<ul style="text-align:center; background-color: #008990;" class="bk-tabs home_footer"><li><a href="https://m.ca-paris.fr/information/legalementions" class="left"><img alt="Mentions légales" src="https://m.ca-paris.fr/bkimages/img/evol/btn_footer_mentions_legales@2x.gif/627/480/GIF" width="107" class="bk"></a></li><li><a href="https://www.ca-paris.fr/" data-bk-ajax="false" class="right"><img alt="Version web" src="https://m.ca-paris.fr/bkimages/img/evol/btn_footer_version_web@2x.gif/627/480/GIF" width="94" class="bk"></a></li></ul>

<div id="legalMentionsTransitionSection" style="display:none"><div id="legalMentionsTransitionLoadingSection"></div></div></div></div><div id="transitionLoaderSection" style="display:none"></div></div></body></html>